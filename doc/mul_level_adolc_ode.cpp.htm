<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>Taylor's Ode Solver: A Multi-Level Adolc Example and Test</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="Taylor's Ode Solver: A Multi-Level Adolc Example and Test">
<meta name="keywords" id="keywords" content=" taylor's ode solver: multi-level adolc example test see also purpose solution derivative method using ad base_adolc.hpp memory management configuration requirement source ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_mul_level_adolc_ode.cpp_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://coin-or.github.io/CppAD" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td><a href="mul_level_ode.cpp.htm" target="_top">Prev</a>
</td><td><a href="stack_machine.cpp.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_across0(this)'>
<option>Index-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Up-&gt;</option>
<option>CppAD</option>
<option>Example</option>
<option>General</option>
<option>mul_level_adolc_ode.cpp</option>
</select>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_cppad_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_example_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_general_htm.js'></script>
</td>
<td>mul_level_adolc_ode.cpp</td>
<td>
<select onchange='choose_current0(this)'>
<option>Headings-&gt;</option>
<option>See Also</option>
<option>Purpose</option>
<option>ODE</option>
<option>ODE Solution</option>
<option>Derivative of ODE Solution</option>
<option>Taylor's Method Using AD</option>
<option>base_adolc.hpp</option>
<option>Memory Management</option>
<option>Configuration Requirement</option>
<option>Source</option>
</select>
</td>
</tr></table><br>
@(@\newcommand{\W}[1]{ \; #1 \; }
\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\D}[2]{ \frac{\partial #1}{\partial #2} }
\newcommand{\DD}[3]{ \frac{\partial^2 #1}{\partial #2 \partial #3} }
\newcommand{\Dpow}[2]{ \frac{\partial^{#1}}{\partial  {#2}^{#1}} }
\newcommand{\dpow}[2]{ \frac{ {\rm d}^{#1}}{{\rm d}\, {#2}^{#1}} }@)@<center><b><big><big>Taylor's Ode Solver: A Multi-Level Adolc Example and Test</big></big></b></center>
<br>
<b><big><a name="See Also" id="See Also">See Also</a></big></b>

<br>
<a href="taylor_ode.cpp.htm" target="_top"><span style='white-space: nowrap'>taylor_ode.cpp</span></a>
, <a href="mul_level_ode.cpp.htm" target="_top"><span style='white-space: nowrap'>mul_level_ode.cpp</span></a>


<br>
<br>
<b><big><a name="Purpose" id="Purpose">Purpose</a></big></b>
<br>
This is a realistic example using
two levels of AD; see <a href="mul_level.htm" target="_top"><span style='white-space: nowrap'>mul_level</span></a>
.
The first level uses Adolc's <code><font color="blue">adouble</font></code> type
to tape the solution of an ordinary differential equation.
This solution is then differentiated with respect to a parameter vector.
The second level uses CppAD's type <code><font color="blue">AD&lt;adouble&gt;</font></code>
to take derivatives during the solution of the differential equation.
These derivatives are used in the application
of Taylor's method to the solution of the ODE.


<br>
<br>
<b><big><a name="ODE" id="ODE">ODE</a></big></b>
<br>
For this example the function
<small>@(@
y : \B{R} \times \B{R}^n \rightarrow \B{R}^n
@)@</small> is defined by
<small>@(@
y(0, x) = 0
@)@</small> and
<small>@(@
\partial_t y(t, x) = g(y, x)
@)@</small> where
<small>@(@
g : \B{R}^n \times \B{R}^n \rightarrow \B{R}^n
@)@</small> is defined by
<small>@[@

    g(y, x) =
    \left( \begin{array}{c}
            x_0     \\
            x_1 y_0 \\
            \vdots  \\
            x_{n-1} y_{n-2}
    \end{array} \right)

@]@</small>

<br>
<br>
<b><big><a name="ODE Solution" id="ODE Solution">ODE Solution</a></big></b>
<br>
The solution for this example can be calculated by
starting with the first row and then using the solution
for the first row to solve the second and so on.
Doing this we obtain
<small>@[@

    y(t, x ) =
    \left( \begin{array}{c}
        x_0 t                  \\
        x_1 x_0 t^2 / 2        \\
        \vdots                 \\
        x_{n-1} x_{n-2} \ldots x_0 t^n / n !
    \end{array} \right)

@]@</small>

<br>
<br>
<b><big><a name="Derivative of ODE Solution" id="Derivative of ODE Solution">Derivative of ODE Solution</a></big></b>
<br>
Differentiating the solution above,
with respect to the parameter vector <small>@(@
x
@)@</small>,
we notice that
<small>@[@

\partial_x y(t, x ) =
\left( \begin{array}{cccc}
y_0 (t,x) / x_0      & 0                   & \cdots & 0      \\
y_1 (t,x) / x_0      & y_1 (t,x) / x_1     & 0      & \vdots \\
\vdots               & \vdots              & \ddots & 0      \\
y_{n-1} (t,x) / x_0  & y_{n-1} (t,x) / x_1 & \cdots & y_{n-1} (t,x) / x_{n-1}
\end{array} \right)

@]@</small>

<br>
<br>
<b><big><a name="Taylor's Method Using AD" id="Taylor's Method Using AD">Taylor's Method Using AD</a></big></b>
<br>
We define the function <small>@(@
z(t, x)
@)@</small> by the equation
<small>@[@

    z ( t , x ) = g[ y ( t , x ) ] = h [ x , y( t , x ) ]

@]@</small>
see <a href="taylor_ode.htm" target="_top"><span style='white-space: nowrap'>taylor_ode</span></a>
 for the method used to compute the
Taylor coefficients w.r.t <small>@(@
t
@)@</small> of <small>@(@
y(t, x)
@)@</small>.

<br>
<br>
<b><big><a name="base_adolc.hpp" id="base_adolc.hpp">base_adolc.hpp</a></big></b>
<br>
The file <a href="base_adolc.hpp.htm" target="_top"><span style='white-space: nowrap'>base_adolc.hpp</span></a>
 is implements the
<a href="base_require.htm" target="_top"><span style='white-space: nowrap'>Base&nbsp;type&nbsp;requirements</span></a>
 where 
<code><i><font color="black"><span style='white-space: nowrap'>Base</span></font></i></code>

is <code><font color="blue">adolc</font></code>.

<br>
<br>
<b><big><a name="Memory Management" id="Memory Management">Memory Management</a></big></b>
<br>
Adolc uses raw memory arrays that depend on the number of
dependent and independent variables.
The <a href="thread_alloc.htm" target="_top"><span style='white-space: nowrap'>thread_alloc</span></a>
 memory management utilities
<a href="ta_create_array.htm" target="_top"><span style='white-space: nowrap'>create_array</span></a>
 and
<a href="ta_delete_array.htm" target="_top"><span style='white-space: nowrap'>delete_array</span></a>

are used to manage this memory allocation.

<br>
<br>
<b><big><a name="Configuration Requirement" id="Configuration Requirement">Configuration Requirement</a></big></b>
<br>
This example will be compiled and tested provided
<a href="cmake.htm#include_ipopt" target="_top"><span style='white-space: nowrap'>include_ipopt</span></a>
 is on the cmake command line.

<br>
<br>
<b><big><a name="Source" id="Source">Source</a></big></b>


<pre><tt>
<i><font color="#9A1900">// suppress conversion warnings before other includes</font></i>
<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;cppad/wno_conversion.hpp&gt;</font>
<i><font color="#9A1900">//</font></i>

<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;adolc/adouble.h&gt;</font>
<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;adolc/taping.h&gt;</font>
<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;adolc/drivers/drivers.h&gt;</font>

<i><font color="#9A1900">// definitions not in Adolc distribution and required to use CppAD::AD&lt;adouble&gt;</font></i>
<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;cppad/example/base_adolc.hpp&gt;</font>

<b><font color="#000080"># include</font></b> <font color="#FF0000">&lt;cppad/cppad.hpp&gt;</font>
<i><font color="#9A1900">// ==========================================================================</font></i>
<b><font color="#0000FF">namespace</font></b> <font color="#FF0000">{</font> <i><font color="#9A1900">// BEGIN empty namespace</font></i>
<i><font color="#9A1900">// define types for each level</font></i>
<b><font color="#0000FF">typedef</font></b> <font color="#008080">adouble</font>           a1type<font color="#990000">;</font>
<b><font color="#0000FF">typedef</font></b> CppAD<font color="#990000">::</font><font color="#008080">AD&lt;a1type&gt;</font> a2type<font color="#990000">;</font>

<i><font color="#9A1900">// -------------------------------------------------------------------------</font></i>
<i><font color="#9A1900">// class definition for C++ function object that defines ODE</font></i>
<b><font color="#0000FF">class</font></b> <font color="#008080">Ode</font> <font color="#FF0000">{</font>
<b><font color="#0000FF">private</font></b><font color="#990000">:</font>
    <i><font color="#9A1900">// copy of a that is set by constructor and used by g(y)</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> a1x_<font color="#990000">;</font>
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
    <i><font color="#9A1900">// constructor</font></i>
    <b><font color="#000000">Ode</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)&amp;</font> a1x<font color="#990000">)</font> <font color="#990000">:</font> <b><font color="#000000">a1x_</font></b><font color="#990000">(</font>a1x<font color="#990000">)</font>
    <font color="#FF0000">{</font> <font color="#FF0000">}</font>
    <i><font color="#9A1900">// the function g(y) is evaluated with two levels of taping</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a2type<font color="#990000">)</font> <b><font color="#0000FF">operator</font></b><font color="#990000">()</font>
    <font color="#990000">(</font> <b><font color="#0000FF">const</font></b> <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a2type<font color="#990000">)&amp;</font> a2y<font color="#990000">)</font> <b><font color="#0000FF">const</font></b>
    <font color="#FF0000">{</font>   <font color="#008080">size_t</font> n <font color="#990000">=</font> a2y<font color="#990000">.</font><b><font color="#000000">size</font></b><font color="#990000">();</font>
        <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a2type<font color="#990000">)</font> <b><font color="#000000">a2g</font></b><font color="#990000">(</font>n<font color="#990000">);</font>
        <font color="#008080">size_t</font> i<font color="#990000">;</font>
        a2g<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">=</font> a1x_<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">];</font>
        <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
            a2g<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> a1x_<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">*</font> a2y<font color="#990000">[</font>i<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">];</font>

        <b><font color="#0000FF">return</font></b> a2g<font color="#990000">;</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">// -------------------------------------------------------------------------</font></i>
<i><font color="#9A1900">// Routine that uses Taylor's method to solve ordinary differential equaitons</font></i>
<i><font color="#9A1900">// and allows for algorithmic differentiation of the solution.</font></i>
<b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> <b><font color="#000000">taylor_ode_adolc</font></b><font color="#990000">(</font>
    <font color="#008080">Ode</font>                            G       <font color="#990000">,</font>  <i><font color="#9A1900">// function that defines the ODE</font></i>
    <font color="#008080">size_t</font>                         order   <font color="#990000">,</font>  <i><font color="#9A1900">// order of Taylor's method used</font></i>
    <font color="#008080">size_t</font>                         nstep   <font color="#990000">,</font>  <i><font color="#9A1900">// number of steps to take</font></i>
    <b><font color="#0000FF">const</font></b> <font color="#008080">a1type</font>                   <font color="#990000">&amp;</font>a1dt   <font color="#990000">,</font>  <i><font color="#9A1900">// Delta t for each step</font></i>
    <b><font color="#0000FF">const</font></b> <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> <font color="#990000">&amp;</font>a1y_ini<font color="#990000">)</font>  <i><font color="#9A1900">// y(t) at the initial time</font></i>
<font color="#FF0000">{</font>
    <i><font color="#9A1900">// some temporary indices</font></i>
    <font color="#008080">size_t</font> i<font color="#990000">,</font> k<font color="#990000">,</font> ell<font color="#990000">;</font>

    <i><font color="#9A1900">// number of variables in the ODE</font></i>
    <font color="#008080">size_t</font> n <font color="#990000">=</font> a1y_ini<font color="#990000">.</font><b><font color="#000000">size</font></b><font color="#990000">();</font>

    <i><font color="#9A1900">// copies of x and g(y) with two levels of taping</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a2type<font color="#990000">)</font>   <b><font color="#000000">a2y</font></b><font color="#990000">(</font>n<font color="#990000">),</font> <b><font color="#000000">Z</font></b><font color="#990000">(</font>n<font color="#990000">);</font>

    <i><font color="#9A1900">// y, y^{(k)} , z^{(k)}, and y^{(k+1)}</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font>  <b><font color="#000000">a1y</font></b><font color="#990000">(</font>n<font color="#990000">),</font> <b><font color="#000000">a1y_k</font></b><font color="#990000">(</font>n<font color="#990000">),</font> <b><font color="#000000">a1z_k</font></b><font color="#990000">(</font>n<font color="#990000">),</font> <b><font color="#000000">a1y_kp</font></b><font color="#990000">(</font>n<font color="#990000">);</font>

    <i><font color="#9A1900">// initialize x</font></i>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        a1y<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> a1y_ini<font color="#990000">[</font>i<font color="#990000">];</font>

    <i><font color="#9A1900">// loop with respect to each step of Taylors method</font></i>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>ell <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ell <font color="#990000">&lt;</font> nstep<font color="#990000">;</font> ell<font color="#990000">++)</font>
    <font color="#FF0000">{</font>   <i><font color="#9A1900">// prepare to compute derivatives using a1type</font></i>
        <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
            a2y<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> a1y<font color="#990000">[</font>i<font color="#990000">];</font>
        CppAD<font color="#990000">::</font><b><font color="#000000">Independent</font></b><font color="#990000">(</font>a2y<font color="#990000">);</font>

        <i><font color="#9A1900">// evaluate ODE using a2type</font></i>
        Z <font color="#990000">=</font> <b><font color="#000000">G</font></b><font color="#990000">(</font>a2y<font color="#990000">);</font>

        <i><font color="#9A1900">// define differentiable version of g: X -&gt; Y</font></i>
        <i><font color="#9A1900">// that computes its derivatives using a1type</font></i>
        CppAD<font color="#990000">::</font><font color="#008080">ADFun&lt;a1type&gt;</font> <b><font color="#000000">a1g</font></b><font color="#990000">(</font>a2y<font color="#990000">,</font> Z<font color="#990000">);</font>

        <i><font color="#9A1900">// Use Taylor's method to take a step</font></i>
        a1y_k            <font color="#990000">=</font> a1y<font color="#990000">;</font>     <i><font color="#9A1900">// initialize y^{(k)}</font></i>
        <font color="#008080">a1type</font> dt_kp <font color="#990000">=</font> a1dt<font color="#990000">;</font>    <i><font color="#9A1900">// initialize dt^(k+1)</font></i>
        <b><font color="#0000FF">for</font></b><font color="#990000">(</font>k <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> k <font color="#990000">&lt;=</font> order<font color="#990000">;</font> k<font color="#990000">++)</font>
        <font color="#FF0000">{</font>   <i><font color="#9A1900">// evaluate k-th order Taylor coefficient of y</font></i>
            a1z_k <font color="#990000">=</font> a1g<font color="#990000">.</font><b><font color="#000000">Forward</font></b><font color="#990000">(</font>k<font color="#990000">,</font> a1y_k<font color="#990000">);</font>

            <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
            <font color="#FF0000">{</font>   <i><font color="#9A1900">// convert to (k+1)-Taylor coefficient for x</font></i>
                a1y_kp<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> a1z_k<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">/</font> <b><font color="#000000">a1type</font></b><font color="#990000">(</font>k <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">);</font>

                <i><font color="#9A1900">// add term for to this Taylor coefficient</font></i>
                <i><font color="#9A1900">// to solution for y(t, x)</font></i>
                a1y<font color="#990000">[</font>i<font color="#990000">]</font>    <font color="#990000">+=</font> a1y_kp<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">*</font> dt_kp<font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <i><font color="#9A1900">// next power of t</font></i>
            dt_kp <font color="#990000">*=</font> a1dt<font color="#990000">;</font>
            <i><font color="#9A1900">// next Taylor coefficient</font></i>
            a1y_k   <font color="#990000">=</font> a1y_kp<font color="#990000">;</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>
    <b><font color="#0000FF">return</font></b> a1y<font color="#990000">;</font>
<font color="#FF0000">}</font>
<font color="#FF0000">}</font> <i><font color="#9A1900">// END empty namespace</font></i>
<i><font color="#9A1900">// ==========================================================================</font></i>
<i><font color="#9A1900">// Routine that tests algorithmic differentiation of solutions computed</font></i>
<i><font color="#9A1900">// by the routine taylor_ode.</font></i>
<font color="#009900">bool</font> <b><font color="#000000">mul_level_adolc_ode</font></b><font color="#990000">(</font><font color="#009900">void</font><font color="#990000">)</font>
<font color="#FF0000">{</font>   <font color="#009900">bool</font> ok <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
    <font color="#009900">double</font> eps <font color="#990000">=</font> <font color="#993399">100</font><font color="#990000">.</font> <font color="#990000">*</font> std<font color="#990000">::</font>numeric_limits<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><b><font color="#000000">epsilon</font></b><font color="#990000">();</font>

    <i><font color="#9A1900">// number of components in differential equation</font></i>
    <font color="#008080">size_t</font> n <font color="#990000">=</font> <font color="#993399">4</font><font color="#990000">;</font>

    <i><font color="#9A1900">// some temporary indices</font></i>
    <font color="#008080">size_t</font> i<font color="#990000">,</font> j<font color="#990000">;</font>

    <i><font color="#9A1900">// set up for thread_alloc memory allocator</font></i>
    <b><font color="#0000FF">using</font></b> CppAD<font color="#990000">::</font>thread_alloc<font color="#990000">;</font> <i><font color="#9A1900">// the allocator</font></i>
    <font color="#008080">size_t</font> capacity<font color="#990000">;</font>           <i><font color="#9A1900">// capacity of an allocation</font></i>

    <i><font color="#9A1900">// the vector x with length n (or greater) in double</font></i>
    <font color="#009900">double</font><font color="#990000">*</font> x <font color="#990000">=</font> thread_alloc<font color="#990000">::</font>create_array<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;(</font>n<font color="#990000">,</font> capacity<font color="#990000">);</font>

    <i><font color="#9A1900">// the vector x with length n in a1type</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> <b><font color="#000000">a1x</font></b><font color="#990000">(</font>n<font color="#990000">);</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        a1x<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> x<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> <font color="#009900">double</font><font color="#990000">(</font>i <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">);</font>

    <i><font color="#9A1900">// declare the parameters as the independent variable</font></i>
    <font color="#009900">short</font> tag <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>                     <i><font color="#9A1900">// Adolc setup</font></i>
    <font color="#009900">int</font> keep <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
    <b><font color="#000000">trace_on</font></b><font color="#990000">(</font>tag<font color="#990000">,</font> keep<font color="#990000">);</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        a1x<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">&lt;&lt;=</font> <font color="#009900">double</font><font color="#990000">(</font>i <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">);</font>  <i><font color="#9A1900">// a1x is independent for adouble type</font></i>

    <i><font color="#9A1900">// arguments to taylor_ode_adolc</font></i>
    <font color="#008080">Ode</font> <b><font color="#000000">G</font></b><font color="#990000">(</font>a1x<font color="#990000">);</font>                <i><font color="#9A1900">// function that defines the ODE</font></i>
    <font color="#008080">size_t</font>   order <font color="#990000">=</font> n<font color="#990000">;</font>      <i><font color="#9A1900">// order of Taylor's method used</font></i>
    <font color="#008080">size_t</font>   nstep <font color="#990000">=</font> <font color="#993399">2</font><font color="#990000">;</font>      <i><font color="#9A1900">// number of steps to take</font></i>
    <font color="#008080">a1type</font>   a1dt  <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">.;</font>     <i><font color="#9A1900">// Delta t for each step</font></i>
    <i><font color="#9A1900">// value of y(t, x) at the initial time</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> <b><font color="#000000">a1y_ini</font></b><font color="#990000">(</font>n<font color="#990000">);</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        a1y_ini<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">.;</font>

    <i><font color="#9A1900">// integrate the differential equation</font></i>
    <b><font color="#000000">CPPAD_TESTVECTOR</font></b><font color="#990000">(</font>a1type<font color="#990000">)</font> <b><font color="#000000">a1y_final</font></b><font color="#990000">(</font>n<font color="#990000">);</font>
    a1y_final <font color="#990000">=</font> <b><font color="#000000">taylor_ode_adolc</font></b><font color="#990000">(</font>G<font color="#990000">,</font> order<font color="#990000">,</font> nstep<font color="#990000">,</font> a1dt<font color="#990000">,</font> a1y_ini<font color="#990000">);</font>

    <i><font color="#9A1900">// declare the differentiable fucntion f : x -&gt; y_final</font></i>
    <i><font color="#9A1900">// (corresponding to the tape of adouble operations)</font></i>
    <font color="#009900">double</font><font color="#990000">*</font> y_final <font color="#990000">=</font> thread_alloc<font color="#990000">::</font>create_array<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;(</font>n<font color="#990000">,</font> capacity<font color="#990000">);</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        a1y_final<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">&gt;&gt;=</font> y_final<font color="#990000">[</font>i<font color="#990000">];</font>
    <b><font color="#000000">trace_off</font></b><font color="#990000">();</font>

    <i><font color="#9A1900">// check function values</font></i>
    <font color="#009900">double</font> check <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">.;</font>
    <font color="#009900">double</font> t     <font color="#990000">=</font> nstep <font color="#990000">*</font> a1dt<font color="#990000">.</font><b><font color="#000000">value</font></b><font color="#990000">();</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
    <font color="#FF0000">{</font>   check <font color="#990000">*=</font> x<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">*</font> t <font color="#990000">/</font> <font color="#009900">double</font><font color="#990000">(</font>i <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">);</font>
        ok <font color="#990000">&amp;=</font> CppAD<font color="#990000">::</font><b><font color="#000000">NearEqual</font></b><font color="#990000">(</font>y_final<font color="#990000">[</font>i<font color="#990000">],</font> check<font color="#990000">,</font> eps<font color="#990000">,</font> eps<font color="#990000">);</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">// memory where Jacobian will be returned</font></i>
    <font color="#009900">double</font><font color="#990000">*</font> jac_ <font color="#990000">=</font> thread_alloc<font color="#990000">::</font>create_array<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;(</font>n <font color="#990000">*</font> n<font color="#990000">,</font> capacity<font color="#990000">);</font>
    <font color="#009900">double</font><font color="#990000">**</font> jac <font color="#990000">=</font> thread_alloc<font color="#990000">::</font>create_array<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">*&gt;(</font>n<font color="#990000">,</font> capacity<font color="#990000">);</font>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
        jac<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">=</font> jac_ <font color="#990000">+</font> i <font color="#990000">*</font> n<font color="#990000">;</font>

    <i><font color="#9A1900">// evaluate Jacobian of h at a</font></i>
    <font color="#008080">size_t</font> m <font color="#990000">=</font> n<font color="#990000">;</font>              <i><font color="#9A1900">// # dependent variables</font></i>
    <b><font color="#000000">jacobian</font></b><font color="#990000">(</font>tag<font color="#990000">,</font> <font color="#009900">int</font><font color="#990000">(</font>m<font color="#990000">),</font> <font color="#009900">int</font><font color="#990000">(</font>n<font color="#990000">),</font> x<font color="#990000">,</font> jac<font color="#990000">);</font>

    <i><font color="#9A1900">// check Jacobian</font></i>
    <b><font color="#0000FF">for</font></b><font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> n<font color="#990000">;</font> i<font color="#990000">++)</font>
    <font color="#FF0000">{</font>   <b><font color="#0000FF">for</font></b><font color="#990000">(</font>j <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> j <font color="#990000">&lt;</font> n<font color="#990000">;</font> j<font color="#990000">++)</font>
        <font color="#FF0000">{</font>   <b><font color="#0000FF">if</font></b><font color="#990000">(</font> i <font color="#990000">&lt;</font> j <font color="#990000">)</font>
                check <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">.;</font>
            <b><font color="#0000FF">else</font></b>
                check <font color="#990000">=</font> y_final<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">/</font> x<font color="#990000">[</font>j<font color="#990000">];</font>
            ok <font color="#990000">&amp;=</font> CppAD<font color="#990000">::</font><b><font color="#000000">NearEqual</font></b><font color="#990000">(</font>jac<font color="#990000">[</font>i<font color="#990000">][</font>j<font color="#990000">],</font> check<font color="#990000">,</font> eps<font color="#990000">,</font> eps<font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">// make memroy avaiable for other use by this thread</font></i>
    thread_alloc<font color="#990000">::</font><b><font color="#000000">delete_array</font></b><font color="#990000">(</font>x<font color="#990000">);</font>
    thread_alloc<font color="#990000">::</font><b><font color="#000000">delete_array</font></b><font color="#990000">(</font>y_final<font color="#990000">);</font>
    thread_alloc<font color="#990000">::</font><b><font color="#000000">delete_array</font></b><font color="#990000">(</font>jac_<font color="#990000">);</font>
    thread_alloc<font color="#990000">::</font><b><font color="#000000">delete_array</font></b><font color="#990000">(</font>jac<font color="#990000">);</font>
    <b><font color="#0000FF">return</font></b> ok<font color="#990000">;</font>
<font color="#FF0000">}</font>
</tt></pre>

<hr>Input File: example/general/mul_level_adolc_ode.cpp

</body>
</html>
