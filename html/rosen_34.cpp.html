<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="rosen_34.cpp, rosen_34:, example, and, test" name="keywords" />
<meta content="operation, sequence" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rosen_34.cpp &mdash; cppad  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Runge45" href="Runge45.html" />
    <link rel="prev" title="Rosen34" href="Rosen34.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="xrst_root_doc.html" class="icon icon-home"> cppad
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="xrst_table_of_contents.html">Table of Contents</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="CppAD.html">CppAD</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Install.html">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="Theory.html">Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="AD.html">AD</a></li>
<li class="toctree-l2"><a class="reference internal" href="ADFun.html">ADFun</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessor.html">preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_thread.html">multi_thread</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="utility.html">utility</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="CheckNumericType.html">CheckNumericType</a></li>
<li class="toctree-l3"><a class="reference internal" href="CheckSimpleVector.html">CheckSimpleVector</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_dll_lib.html">create_dll_lib</a></li>
<li class="toctree-l3"><a class="reference internal" href="ErrorHandler.html">ErrorHandler</a></li>
<li class="toctree-l3"><a class="reference internal" href="index_sort.html">index_sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="link_dll_lib.html">link_dll_lib</a></li>
<li class="toctree-l3"><a class="reference internal" href="nan.html">nan</a></li>
<li class="toctree-l3"><a class="reference internal" href="NearEqual.html">NearEqual</a></li>
<li class="toctree-l3"><a class="reference internal" href="OdeErrControl.html">OdeErrControl</a></li>
<li class="toctree-l3"><a class="reference internal" href="OdeGear.html">OdeGear</a></li>
<li class="toctree-l3"><a class="reference internal" href="OdeGearControl.html">OdeGearControl</a></li>
<li class="toctree-l3"><a class="reference internal" href="CppAD_vector.html">CppAD_vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="Poly.html">Poly</a></li>
<li class="toctree-l3"><a class="reference internal" href="pow_int.html">pow_int</a></li>
<li class="toctree-l3"><a class="reference internal" href="RombergMul.html">RombergMul</a></li>
<li class="toctree-l3"><a class="reference internal" href="RombergOne.html">RombergOne</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="Rosen34.html">Rosen34</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">rosen_34.cpp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Runge45.html">Runge45</a></li>
<li class="toctree-l3"><a class="reference internal" href="set_union.html">set_union</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse2eigen.html">sparse2eigen</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse_rc.html">sparse_rc</a></li>
<li class="toctree-l3"><a class="reference internal" href="sparse_rcv.html">sparse_rcv</a></li>
<li class="toctree-l3"><a class="reference internal" href="speed_test.html">speed_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="SpeedTest.html">SpeedTest</a></li>
<li class="toctree-l3"><a class="reference internal" href="test_boolofvoid.html">test_boolofvoid</a></li>
<li class="toctree-l3"><a class="reference internal" href="time_test.html">time_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="to_string.html">to_string</a></li>
<li class="toctree-l3"><a class="reference internal" href="lu_det_and_solve.html">lu_det_and_solve</a></li>
<li class="toctree-l3"><a class="reference internal" href="NumericType.html">NumericType</a></li>
<li class="toctree-l3"><a class="reference internal" href="SimpleVector.html">SimpleVector</a></li>
<li class="toctree-l3"><a class="reference internal" href="thread_alloc.html">thread_alloc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ipopt_solve.html">ipopt_solve</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example.html">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed.html">speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="Appendix.html">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xrst_index.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="xrst_root_doc.html">cppad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="xrst_root_doc.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="CppAD.html">CppAD</a> &raquo;</li>
          <li><a href="utility.html">utility</a> &raquo;</li>
          <li><a href="Rosen34.html">Rosen34</a> &raquo;</li>
      <li>rosen_34.cpp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/rosen_34.cpp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p class="hidden"><span class="math notranslate nohighlight">\(\newcommand{\W}[1]{ \; #1 \; }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\R}[1]{ {\rm #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\B}[1]{ {\bf #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\D}[2]{ \frac{\partial #1}{\partial #2} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\DD}[3]{ \frac{\partial^2 #1}{\partial #2 \partial #3} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\Dpow}[2]{ \frac{\partial^{#1}}{\partial  {#2}^{#1}} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\dpow}[2]{ \frac{ {\rm d}^{#1}}{{\rm d}\, {#2}^{#1}} }\)</span></p>
<section id="rosen-34-cpp">
<span id="rosen-34-cpp-name"></span><h1>rosen_34.cpp<a class="headerlink" href="#rosen-34-cpp" title="Permalink to this headline"></a></h1>
<section id="rosen-34-example-and-test">
<span id="rosen-34-cpp-title"></span><span id="index-0"></span><h2>rosen_34: Example and Test<a class="headerlink" href="#rosen-34-example-and-test" title="Permalink to this headline"></a></h2>
<p>Define
<span class="math notranslate nohighlight">\(X : \B{R} \rightarrow \B{R}^n\)</span> by</p>
<div class="math notranslate nohighlight">
\[X_i (t) =  t^{i+1}\]</div>
<p>for <span class="math notranslate nohighlight">\(i = 1 , \ldots , n-1\)</span>.
It follows that</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rclr}
X_i(0)     &amp; = &amp; 0                             &amp; {\rm for \; all \;} i \\
X_i ' (t)  &amp; = &amp; 1                             &amp; {\rm if \;} i = 0      \\
X_i '(t)   &amp; = &amp; (i+1) t^i = (i+1) X_{i-1} (t) &amp; {\rm if \;} i &gt; 0
\end{array}\end{split}\]</div>
<p>The example tests Rosen34 using the relations above:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#operation-sequence" id="id1">Operation Sequence</a></p></li>
</ul>
</div>
<section id="operation-sequence">
<span id="rosen-34-cpp-operation-sequence"></span><span id="index-1"></span><h3><a class="toc-backref" href="#id1">Operation Sequence</a><a class="headerlink" href="#operation-sequence" title="Permalink to this headline"></a></h3>
<p>The <a class="reference internal" href="Rosen34.html#rosen34-name"><span class="std std-ref">Rosen34</span></a> method for solving ODE’s requires the inversion
of a system of linear equations.
This indices used for pivoting may change with different values
for <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(x\)</span>.
This example checks the comparison operators.
If some of the comparisons change,
it makes a new recording of the function with the pivots for the current
<span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(x\)</span>.
Note that one could skip this step and always use the same pivot.
This would not be as numerically stable,
but it would still solve the equations
(so long as none of the pivot elements are zero).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/cppad.hpp&gt;</span><span class="c1">        // For automatic differentiation</span><span class="cp"></span>

<span class="k">namespace</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">class</span><span class="w"> </span><span class="nc">Fun</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w">           </span><span class="n">use_x_</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">CppAD</span><span class="o">::</span><span class="n">ADFun</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">CppAD</span><span class="o">::</span><span class="n">ADFun</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ode_dep_</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="c1">// constructor</span>
<span class="w">      </span><span class="n">Fun</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">use_x</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">use_x_</span><span class="p">(</span><span class="n">use_x</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// compute f(t, x) both for double and AD&lt;double&gt;</span>
<span class="w">      </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">Scalar</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">Ode</span><span class="p">(</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">Scalar</span><span class="w">                   </span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">Scalar</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">Scalar</span><span class="p">)</span><span class="w">       </span><span class="o">&amp;</span><span class="n">f</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">         </span><span class="n">Scalar</span><span class="w"> </span><span class="nf">ti</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="n">ti</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">use_x_</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"></span>
<span class="w">               </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ti</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// compute partial of f(t, x) w.r.t. t using AD</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">Ode_ind</span><span class="p">(</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w">                   </span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w">       </span><span class="o">&amp;</span><span class="n">f_t</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">CppAD</span><span class="p">;</span><span class="w"></span>

<span class="w">         </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">         </span><span class="kt">bool</span><span class="w">   </span><span class="n">ode_ind_defined</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">size_var</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">t_vec</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">t_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="kt">bool</span><span class="w"> </span><span class="n">retape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ode_ind_defined</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="c1">// check if any comparison operators have a different result</span>
<span class="w">            </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">new_dynamic</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">Forward</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t_vec</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">retape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">compare_change_number</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">retape</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="c1">// record function that evaluates f(t, x)</span>
<span class="w">            </span><span class="c1">// with t as independent variable and x as dynamcic parameter</span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">ax</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">af</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// set argument values</span>
<span class="w">            </span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>

<span class="w">            </span><span class="c1">// declare independent variables and dynamic parameters</span>
<span class="w">            </span><span class="kt">size_t</span><span class="w"> </span><span class="n">abort_op_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">bool</span><span class="w">   </span><span class="n">record_compare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">Independent</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="w"> </span><span class="n">abort_op_index</span><span class="p">,</span><span class="w"> </span><span class="n">record_compare</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// compute f(t, x)</span>
<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ode</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">af</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// define AD function object</span>
<span class="w">            </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">Dependent</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="w"> </span><span class="n">af</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// store result in ode_ind_ so can be re-used</span>
<span class="w">            </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">size_var</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="c1">// special case where new_dynamic not yet set</span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">ode_ind_defined</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">new_dynamic</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">// compute partial of f w.r.t t</span>
<span class="w">         </span><span class="n">f_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">Jacobian</span><span class="p">(</span><span class="n">t_vec</span><span class="p">);</span><span class="w"> </span><span class="c1">// partial f(t, x) w.r.t. t</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// compute partial of f(t, x) w.r.t. x using AD</span>
<span class="w">      </span><span class="kt">void</span><span class="w"> </span><span class="n">Ode_dep</span><span class="p">(</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w">                   </span><span class="o">&amp;</span><span class="n">t</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w">       </span><span class="o">&amp;</span><span class="n">f_x</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">CppAD</span><span class="p">;</span><span class="w"></span>

<span class="w">         </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">         </span><span class="kt">bool</span><span class="w">   </span><span class="n">ode_dep_defined</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">size_var</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">t_vec</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">dx</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">t_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="kt">bool</span><span class="w"> </span><span class="n">retape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ode_dep_defined</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="c1">// check if any comparison operators have a differrent result</span>
<span class="w">            </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">new_dynamic</span><span class="p">(</span><span class="n">t_vec</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">Forward</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">retape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">compare_change_number</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">retape</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="c1">// record function that evaluates f(t, x)</span>
<span class="w">            </span><span class="c1">// with x as independent variable and t as dynamcic parameter</span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">ax</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="n">AD</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">af</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// set argument values</span>
<span class="w">            </span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>

<span class="w">            </span><span class="c1">// declare independent variables</span>
<span class="w">            </span><span class="kt">size_t</span><span class="w"> </span><span class="n">abort_op_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">bool</span><span class="w">   </span><span class="n">record_compare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">Independent</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">abort_op_index</span><span class="p">,</span><span class="w"> </span><span class="n">record_compare</span><span class="p">,</span><span class="w"> </span><span class="n">at</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// compute f(t, x)</span>
<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Ode</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">af</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// define AD function object</span>
<span class="w">            </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">Dependent</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="w"> </span><span class="n">af</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="c1">// store result in ode_dep_ so can be re-used</span>
<span class="w">            </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">ode_ind_</span><span class="p">.</span><span class="n">size_var</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="c1">// special case where new_dynamic not yet set</span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">ode_dep_defined</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">new_dynamic</span><span class="p">(</span><span class="n">t_vec</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">// compute partial of f w.r.t x</span>
<span class="w">         </span><span class="n">f_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ode_dep_</span><span class="p">.</span><span class="n">Jacobian</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// partial f(t, x) w.r.t. x</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>


<span class="w">   </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="n">rosen_34</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">     </span><span class="c1">// initial return value</span>

<span class="w">   </span><span class="k">using</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">NearEqual</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">eps99</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">99.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">epsilon</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="kt">size_t</span><span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">      </span><span class="c1">// number components in X(t) and order of method</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w">  </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">      </span><span class="c1">// number of Rosen34 steps in [ti, tf]</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">ti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w">     </span><span class="c1">// initial time</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">tf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="p">;</span><span class="w">     </span><span class="c1">// final time</span>

<span class="w">   </span><span class="c1">// xi = X(0)</span>
<span class="w">   </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">xi</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">use_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">use_x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">use_x</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="c1">// function object depends on value of use_x</span>
<span class="w">      </span><span class="n">Fun</span><span class="w"> </span><span class="nf">F</span><span class="p">(</span><span class="n">use_x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// compute Rosen34 approximation for X(tf)</span>
<span class="w">      </span><span class="n">CPPAD_TESTVECTOR</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">xf</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">xf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">Rosen34</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="n">ti</span><span class="p">,</span><span class="w"> </span><span class="n">tf</span><span class="p">,</span><span class="w"> </span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="c1">// check that error is always positive</span>
<span class="w">         </span><span class="n">ok</span><span class="w">    </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">// 4th order method is exact for i &lt; 4</span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"></span>
<span class="w">            </span><span class="n">NearEqual</span><span class="p">(</span><span class="n">xf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">check</span><span class="p">,</span><span class="w"> </span><span class="n">eps99</span><span class="p">,</span><span class="w"> </span><span class="n">eps99</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">// 3rd order method is exact for i &lt; 3</span>
<span class="w">         </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">ok</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">eps99</span><span class="p">);</span><span class="w"></span>

<span class="w">         </span><span class="c1">// check value for next i</span>
<span class="w">         </span><span class="n">check</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">tf</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">ok</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Rosen34.html" class="btn btn-neutral float-left" title="Rosen34" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Runge45.html" class="btn btn-neutral float-right" title="Runge45" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>